{% extends 'base.html' %}
{% load static %}


{% block content %}
<link rel="stylesheet" href="{% static 'gallery/style.css' %}?v=4">
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h2>Gallery</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Gallery</li>
            </ol>
        </nav>
    </div>
</section>
<!-- Professional Intro -->
<section class="gallery-intro container text-center my-5">
    <h1 class="gallery-heading">
        A Visual Journey Into <span class="highlight">Our Work</span>
    </h1>
    <p class="gallery-subtext">
        Every project tells a story — of passion, precision, and creativity. Our gallery is more than images;
        it’s a glimpse into the spaces we’ve crafted, the experiences we’ve shaped, and the trust we’ve earned.
        Explore and imagine what we can build together.
    </p>
</section>
<!-- Gallery Grid -->
<section class="gallery-section">
    <div class="container">
        <div class="gallery-grid">
            {% for img in images %}
            <div class="gallery-item scroll-fade">
                <div class="gallery-thumb">
                    <img src="{{ img.image.url }}" alt="{{ img.title|default:'Gallery image' }}">
                    <div class="view-more">View More</div>
                </div>
                <div class="caption">
                    <h5>{{ img.title }}</h5>
                </div>
            </div>
            {% empty %}
            <p class="text-center w-100 text-muted">No images yet. Please check back soon.</p>
            {% endfor %}
        </div>
    </div>
</section>
<!-- Modal -->
<div id="galleryModal" class="modal" aria-hidden="true" role="dialog" aria-label="Image preview">
    <button class="close" type="button" aria-label="Close">&times;</button>
    <button class="nav-btn prev" type="button" aria-label="Previous">&#10094;</button>
    <div class="modal-inner">
        <img id="modalImage" class="modal-image" alt="">
        <div id="modalCaption" class="modal-caption"></div>
    </div>
    <button class="nav-btn next" type="button" aria-label="Next">&#10095;</button>
</div>

<script>

    document.body.classList.add('js-enabled');
    (function () {
        const cards = document.querySelectorAll('.scroll-fade');

        const reveal = (el) => el.classList.add('visible');

        if ('IntersectionObserver' in window) {
            const io = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        reveal(entry.target);
                        io.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.15 });

            cards.forEach(c => io.observe(c));
        } else {
            cards.forEach(reveal);
        }
    })();

    // Modal logic
    (function () {
        const modal = document.getElementById('galleryModal');
        const modalImg = document.getElementById('modalImage');
        const modalCaption = document.getElementById('modalCaption');
        const closeBtn = modal.querySelector('.close');
        const prevBtn = modal.querySelector('.prev');
        const nextBtn = modal.querySelector('.next');
        const thumbs = Array.from(document.querySelectorAll('.gallery-grid .gallery-item img'));
        let currentIndex = 0;

        function openModal(index) {
            if (!thumbs.length) return;
            currentIndex = index;
            updateModal();
            modal.classList.add('open');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modal.classList.remove('open');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }

        function updateModal() {
            const img = thumbs[currentIndex];
            modalImg.src = img.src;
            modalImg.alt = img.alt || '';
            const captionEl = img.closest('.gallery-item').querySelector('.caption');
            modalCaption.textContent = captionEl ? captionEl.textContent : (img.alt || '');
        }

        // Open on click
        thumbs.forEach((img, i) => {
            img.addEventListener('click', () => openModal(i));
        });

        // Close handlers
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (!modal.classList.contains('open')) return;
            if (e.key === 'Escape') closeModal();
            if (e.key === 'ArrowRight') next();
            if (e.key === 'ArrowLeft') prev();
        });

        // Navigation
        function next() {
            currentIndex = (currentIndex + 1) % thumbs.length;
            updateModal();
        }
        function prev() {
            currentIndex = (currentIndex - 1 + thumbs.length) % thumbs.length;
            updateModal();
        }
        nextBtn.addEventListener('click', (e) => { e.stopPropagation(); next(); });
        prevBtn.addEventListener('click', (e) => { e.stopPropagation(); prev(); });
    })();
</script>

{% endblock %}